---
title: "Analysis report by drc-ecotox (Î²)"
date: "`r format(Sys.time(), '%Y/%m/%d')`"
output: word_document
---

## 0. Test type
```{r ,echo=FALSE}
if(input$test_type == 'TG201'){
  print("Test No. 201: Freshwater Alga and Cyanobacteria, Growth Inhibition Test")
}else if(input$test_type == 'TG202') {
  print("Test No. 202: Daphnia sp. Acute Immobilisation Test")
} else if(input$test_type == 'TG203') {
  print("Test No. 203: Fish, Acute Toxicity Test")
} else if(input$test_type == 'TG218') {
  print("Test No. 218: Sediment-Water Chironomid Toxicity Using Spiked Sediment or Test No. 219: Sediment-Water Chironomid Toxicity Using Spiked Water")
} else if(input$test_type == 'TG235') {
  print("Test No. 235: Chironomus sp., Acute Immobilisation Test")
}
```
  

## 1. Summary of input data
```{r data, collapse=TRUE, echo=FALSE}
# Check mean and sd at each concentration
if(input$test_type == 'TG202' | input$test_type == 'TG235'){
  filedata()
}else if(input$test_type == 'TG203') {
  filedata() %>%
  group_by(CONC,TIME) %>% 
  summarize_at(vars(-BEAKER),.funs= c(mean,sd)) %>%
  rename(TOTAL_mean = TOTAL_fn1, TOTAL_sd =TOTAL_fn2, IMMOBILIZED_mean = IMMOBILIZED_fn1, IMMOBILIZED_sd = IMMOBILIZED_fn2)
}
```

## 2. Fitting the selected model 
```{r model, collapse=TRUE, echo=FALSE}
# show the selected model
if(input$test_type == 'TG201'){
  if(input$model_TG201 =='ll2'){
  print("Selected model: Log-logistic 2 parameters")
  } else if (input$model_TG201 =='ll4'){
    print("Selected model: Log-logistic 4 parameters")
    }
} else if(input$test_type == 'TG235'){
  if(input$model_TG235 =='ll2'){
  print("Selected model: Log-logistic 2 parameters")
  } else if (input$model_TG235 =='ll4'){
    print("Selected model: Log-logistic 4 parameters")
    }
}
print("")
print(fitmodel())
print(ECx())
```

## 4. Session Info
```{r sessionInfo}
sessionInfo()
```
